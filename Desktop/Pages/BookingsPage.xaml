<Page x:Class="Desktop.Pages.BookingsPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:conv="clr-namespace:Desktop.Converters"
      Title="BookingsPage">

    <Page.Resources>
        <conv:IdToNameConverter x:Key="UserConverter" />
        <conv:IdToNameConverter x:Key="RestaurantConverter" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header (без стилей) -->
        <Border Grid.Row="0" Background="{StaticResource CardBrush}"
                CornerRadius="12" Margin="16,16,16,12" Padding="24,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock Text="📅 Управление бронированиями" Foreground="{StaticResource TextBrush}"
 FontSize="18" FontWeight="SemiBold"/>
                    <TextBlock Text="Все бронирования ресторанов" FontSize="13" Margin="0,4,0,0" Foreground="Gray"/>
                    <TextBox x:Name="SearchTextBox" Margin="0,12,0,0" Height="36" Padding="32,8,12,8"
                             TextChanged="SearchTextBox_TextChanged"
                             ToolTip="Поиск по номеру, клиенту, ресторану, дате..."/>
                </StackPanel>
                <StackPanel  Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button  Content="Добавить"  Style="{StaticResource PrimaryButtonStyle}" Margin="8,0,0,0"   Padding="12,6" Height="24" Width="125" Click="BtnAddBooking_Click"/>
                    <Button Content="Изменить"
                           Style="{StaticResource PrimaryButtonStyle}"
                           Margin="8,0,0,0"
                          
                           Padding="12,6" Click="BtnEditSelected_Click" Height="27"/>
                    <Button Content="Удалить"
                           Style="{StaticResource SecondaryButtonStyle}"
                           Margin="8,0,0,0"
                          
                           Padding="12,6" Click="BtnDeleteSelected_Click" Height="24"/>
                    <Button Content="Обновить"
                           Style="{StaticResource SecondaryButtonStyle}"
                           Margin="8,0,0,0"
                          
                           Padding="12,6" Click="BtnRefresh_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Таблица -->
        <DataGrid x:Name="BookingsGrid" Grid.Row="1" Margin="10" AutoGenerateColumns="False"
                  IsReadOnly="True" SelectionMode="Single" SelectionChanged="BookingsGrid_SelectionChanged"
                  ItemsSource="{Binding FilteredBookings}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="№" Binding="{Binding Id}" Width="60"/>
                <DataGridTextColumn Header="Клиент" Binding="{Binding User_Id, Converter={StaticResource UserConverter}}" Width="180"/>
                <DataGridTextColumn Header="Ресторан" Binding="{Binding Restaurant_Id, Converter={StaticResource RestaurantConverter}}" Width="*"/>
                <DataGridTextColumn Header="Дата" Binding="{Binding Booking_Date, StringFormat=dd.MM.yyyy}" Width="120"/>
                <DataGridTextColumn Header="Гостей" Binding="{Binding Number_Of_Guests}" Width="80"/>
                <DataGridTextColumn Header="Статус" Binding="{Binding Status}" Width="120"/>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Карточки (простой вариант без DropShadowEffect) -->
        <ScrollViewer Grid.Row="2" Margin="10">
            <ItemsControl ItemsSource="{Binding FilteredBookings}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" BorderBrush="LightGray" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,8">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="{Binding Restaurant_Id, Converter={StaticResource RestaurantConverter}}" FontSize="14" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding User_Id, Converter={StaticResource UserConverter}}" FontSize="12" Margin="0,2,0,0" Foreground="Gray"/>
                                    <TextBlock Text="{Binding Booking_Date, StringFormat=dd.MM.yyyy}" FontSize="11" Margin="0,8,0,0"/>
                                    <TextBlock Text="Гостей: {Binding Number_Of_Guests}" FontSize="11"/>
                                </StackPanel>
                                <TextBlock Grid.Column="1" Text="{Binding Status}" FontSize="11" Foreground="Blue" VerticalAlignment="Top"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Лоадер -->
        <Grid x:Name="LoadingOverlay" Grid.RowSpan="3" Background="#80000000" Visibility="Collapsed">
            <ProgressBar IsIndeterminate="True" Width="200" Height="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</Page>